<?xml version="1.0"?>
<launch>
  <!-- This launch file is auto-generated by the autoware_system_designer -->
  <!-- Component Launcher: {{ namespace }} -->
  <!-- Compute Unit: {{ compute_unit }} -->
  <!-- This launcher starts all nodes in component: {{ namespace }} -->
{% macro node_configuration(node) %}
<!-- Remap input and output topics -->
{% for port in node.ports %}
<remap from="{{ port.remap_target }}" to="{{ port.topic }}"/>
{% endfor %}

<!-- Parameters - Non-Override Parameters -->
{% for param in node.parameters %}
{% if param.parameter_type.name != 'OVERRIDE' %}
<param name="{{ param.name }}" value="{{ param.value }}"/>
{% endif %}
{% endfor %}

<!-- Parameters - Override Parameter files -->
{% for param_file in node.parameter_files %}
{% if param_file.parameter_type.name == 'OVERRIDE_FILE' %}
<param from="{{ param_file.path }}" allow_substs="{{ param_file.allow_substs }}"/>
{% endif %}
{% endfor %}

<!-- Parameters - Mode Parameter files -->
{% for param_file in node.parameter_files %}
{% if param_file.parameter_type.name == 'MODE_FILE' %}
<param from="{{ param_file.path }}" allow_substs="{{ param_file.allow_substs }}"/>
{% endif %}
{% endfor %}

<!-- Parameters - Overrides -->
{% for param in node.parameters %}
{% if param.parameter_type.name == 'OVERRIDE' %}
<param name="{{ param.name }}" value="{{ param.value }}"/>
{% endif %}
{% endfor %}
{% endmacro %}

{% for node in nodes %}
  <!-- Node: {{ node.full_namespace }}/{{ node.name }} -->
{% if node.is_ros2_file_launch %}
  <include file="$(find-pkg-share {{node.package}})/launch/{{node.ros2_launch_file}}">
{% for param_file in node.parameter_files %}
    <arg name="{{ param_file.name }}" value="{{ param_file.path }}"/>
{% endfor %}
{% for param in node.parameters %}
{% if param.parameter_type.name == 'DEFAULT' or param.parameter_type.name == 'DEFAULT_FILE' %}
    <arg name="{{ param.name }}" value="{{ param.value }}"/>
{% endif %}
{% endfor %}
{% for param in node.parameters %}
{% if param.parameter_type.name == 'MODE' %}
    <arg name="{{ param.name }}" value="{{ param.value }}"/>
{% endif %}
{% endfor %}
{% for param in node.parameters %}
{% if param.parameter_type.name == 'OVERRIDE' %}
    <arg name="{{ param.name }}" value="{{ param.value }}"/>
{% endif %}
{% endfor %}
  </include>
{% elif node.use_container %}
  <load_composable_node target="{{ node.container }}">
    <composable_node pkg="{{ node.package }}" plugin="{{ node.plugin }}" name="{{ node.name }}" namespace="{{ node.full_namespace }}">
      {{ node_configuration(node)|indent(6) }}
    </composable_node>
  </load_composable_node>
{% else %}
  <node pkg="{{ node.package }}" exec="{{ node.executable }}" name="{{ node.name }}" namespace="{{ node.full_namespace }}" output="{{ node.node_output }}">
    {{ node_configuration(node)|indent(4) }}
  </node>
{% endif %}

{% endfor %}
</launch>
